var UIRelayControl={createNew:function(j,c){var b=j;var k=c;var d="";var h=".delete";var l=".resume";var f={};var a="";var g="";var e="";var i={};f.Init=function(){i=ErrorHandle.createNew();b.HideAllOption();b.ShowOption(DivRelay);f.InitMassEntryDialog();f.GetRelayList();$("#btn_refresh").click(function(){f.GetRelayList()});$("#btn_create").click(function(){f.CreateRelayAction()});$("#rl").click(function(){b.HideAllOption();b.ShowOption(DivRelay);f.GetRelayList()});$("#file_mass_create").change(function(m){$("#uploadFile").val($(this).val());f.FileBindChangeEvent(m)});$("#btn_mass_create").click(function(){f.MassFileCreateAction()})};f.InitMassEntryDialog=function(){$("#modal_update_progress_content").dialog({title:"Mass Entry",modal:true,resizable:false,draggable:false,closeOnEscape:false,autoOpen:false,dialogClass:"no-close",height:450,width:560});$("#progressbar").progressbar({value:0,max:100,complete:function(){$("#closedialog").show()}});$("#closedialog").click(function(){d="";$("#modal_update_progress_content").dialog("close");f.GetRelayList()})};f.CheckNum=function(m){return m.match(/^[0-9]*$/)};f.GetRelayList=function(){b.blockPage();var m=k.getRelayList();f.CallBackGetRelay(m)};f.CallBackGetRelay=function(m){m.done(function(p,n,o){b.stopPage();b.clearTable();b.appendTable(p);f.RebindDeleteEvert();f.RebindResumeEvert()});m.fail(function(n,o){b.stopPage();i.CheckAuth(n.status,ActionStatus.GetRelay)})};f.RebindDeleteEvert=function(){$(h).click(function(){var m=$(this);f.DeleteRelay(relayList[m.attr("id")]["id"])})};f.DeleteRelay=function(n){b.blockPage();var m=k.deleteRelay(n);f.CallBackDeleteRelay(m)};f.CallBackDeleteRelay=function(m){m.done(function(p,n,o){setTimeout(function(){f.GetRelayList()},200)});m.fail(function(n,o){b.stopPage();i.CheckAuth(n.status,ActionStatus.DeleteRealy)})};f.RebindResumeEvert=function(){$(l).click(function(){var n=$(this);var m=n.attr("id");f.ResumeRelay(m)})};f.ResumeRelay=function(m){b.blockPage();var n=k.resumeRelay(relayList[m]["id"],relayList[m]["source"],relayList[m]["port"],relayList[m]["channelname"]);f.CallBackResumeRelay(n)};f.CallBackResumeRelay=function(m){m.done(function(p,n,o){setTimeout(function(){f.GetRelayList()},1000)});m.fail(function(n,o){b.stopPage();i.CheckAuth(n.status,ActionStatus.ResumeRelay)})};f.CreateRelayAction=function(){var n=true;var s=$("#Source").val();var m=$("#Port").val();var o=$("#DestinationName").val();var r=$("#ChannelNumber").val();var p=$("#Name").val();var q=$("#Description").val();if(!f.VerifyRelayInput(s)){alert("Error : Can't input whitespace and ',' in Source.");return}if(!f.VerifyRelayInput(o)){alert("Error : Can't input whitespace and ',' in Destination Name.");return}if(!f.VerifyRelayInput(p)){alert("Error : Can't input whitespace and ',' in Remark1.");return}if(!f.VerifyRelayInput(q)){alert("Error : Can't input whitespace and ',' in Remark2.");return}if(s.length===0){alert("Error : Please input value in Source.");return}if(m.length===0){alert("Error : Please input value in Port.");return}if(!f.CheckNum(m)){alert("Error : Port must be integer.");return false}m=parseInt(m);if(p.length===0){alert("Error : Please input value in Name.");return}if(r.length===0){alert("Error : Please input value in Channel Number.");return}if(!f.CheckNum(r)){alert("Error : Channel Number must be integer.");return false}r=parseInt(r);$.each(relayList,function(t,u){if(String(m)===u.port){n=false;alert("Error : DUPLICATE PORT NUMBER !");return false}else{if(p===u.name){n=false;alert("Error : DUPLICATE Name !");return false}else{if(String(r)===u.channelnumber){n=false;alert("Error : DUPLICATE Channel Number !");return false}}}});if(!n){return false}f.CreatRelay(r,p,q,s,m,o)};f.VerifyRelayInput=function(o){var m=" ";var n=",";if(o.indexOf(m)!==-1||o.indexOf(n)!==-1){return false}else{return true}};f.CreatRelay=function(s,p,r,q,m,n){b.blockPage();var o=k.createRelay(s,p,r,q,m,n);f.CallBackCreateRelay(o)};f.CallBackCreateRelay=function(m){m.done(function(p,n,o){setTimeout(function(){f.GetRelayList()},6000)});m.fail(function(n,o){b.stopPage();i.CheckAuth(n.status,ActionStatus.CreateRelay)})};f.FileBindChangeEvent=function(o){if(window.File&&window.FileReader&&window.FileList&&window.Blob){d="";var n=o.target.files;$("#uploadFile").val(n[0].name);file=n[0];var m=new FileReader();m.onload=function(){d=m.result};m.readAsText(file)}};f.MassFileCreateAction=function(){$("#uploadFile").val("");$("#file_mass_create").val("");if(window.File&&window.FileReader&&window.FileList&&window.Blob){if(d.length===0){alert("Please select a file to create.");return false}var m=d.trim().split("\n");if(m.length>1001){alert("You can olny create 1000 Items at the same time.");return false}if(m.length>1){f.MassEntryDialog(m)}}else{alert("Please Change Your Browser.Your Browser is not support File API.")}};f.MassEntryDialog=function(o){$("#closedialog").hide();var m=$(".progress-label");var n=o.length-1;a=",";g=",";e=",";$.each(relayList,function(p,q){a+=q.port+",";g+=q.name+",";e+=q.channelnumber+","});m.text("0/"+n);b.EmptyMassEntryResultTable();$("#progressbar").progressbar("option","value",0);$("#progressbar").progressbar("option","max",n);$("#modal_update_progress_content").dialog("open");f.MassCreatRelay(1,o)};f.MassCreatRelay=function(q,o){var n=$(".progress-label");if(q>o.length-1){return false}$("#progressbar").progressbar("option","value",q);n.text(q+"/"+$("#progressbar").progressbar("option","max"));var m=o[q].trim().split(/\s+/);if(f.MassEntryVerifyInput(q,m)){var p=k.createRelay(m[3],m[4],m[5],m[0],m[1],m[2]);f.CallBackMassCreateRelay(q,o,p)}else{++q;f.MassCreatRelay(q,o)}};f.CallBackMassCreateRelay=function(o,m,n){n.done(function(r,p,q){++o;f.MassCreatRelay(o,m)});n.fail(function(p,q){i.CheckAuth(p.status,ActionStatus.CreateRelay)})};f.MassEntryVerifyInput=function(o,m){var o=o+1;if(m.length!==6){b.AppendMassEntryResultTable(o,"Number of Input Fields is not match.");return false}if(m[0].length<=2){b.AppendMassEntryResultTable(o,"Please input value in Source Url.");return false}if(m[1].length===0){b.AppendMassEntryResultTable(o,"Please input value in Destination Port.");return false}if(m[3].length===0){b.AppendMassEntryResultTable(o,"Please input value in Channel Number.");return false}if(m[4].length<=2){b.AppendMassEntryResultTable(o,"Please input value in Name.");return false}var r=m[0];var q=m[2].length>2?m[2].substring(1,m[2].length-1):"";m[2]=q;var n=m[4].substring(1,m[4].length-1);m[4]=n;var p=m[5].length>2?m[5].substring(1,m[5].length-1):"";m[5]=p;if(!f.VerifyRelayInput(r)){b.AppendMassEntryResultTable(o,"Can't input whitespace and ',' in Source Url('"+r+"').");return false}if(!f.VerifyRelayInput(q)){b.AppendMassEntryResultTable(o,"Can't input whitespace and ',' in Destination Name('"+q+"').");return false}if(!f.VerifyRelayInput(n)){b.AppendMassEntryResultTable(o,"Can't input whitespace and ',' in Name('"+n+"').");return false}if(!f.VerifyRelayInput(p)){b.AppendMassEntryResultTable(o,"Can't input whitespace and ',' in Description('"+p+"').");return false}if(!f.CheckNum(m[1])){b.AppendMassEntryResultTable(o,"Destination Port('"+m[1]+"') must be integer.");return false}m[1]=parseInt(m[1]);if(!f.CheckNum(m[3])){b.AppendMassEntryResultTable(o,"Channel Number('"+m[3]+"') must be integer.");return false}m[3]=parseInt(m[3]);if(a.indexOf(m[1])!==-1){b.AppendMassEntryResultTable(o,"Destination Port('"+m[1]+"') is duplicate.");return false}if(g.indexOf(","+n+",")!==-1){b.AppendMassEntryResultTable(o,"Name('"+n+"') is duplicate.");return false}if(e.indexOf(m[3])!==-1){b.AppendMassEntryResultTable(o,"Channel Number('"+m[3]+"') is duplicate.");return false}a+=m[1]+",";e+=m[3]+",";g+=n+",";return true};return f}};